<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ru" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Particle эффекты в мобильных играх - Fateev.pro</title>
<meta name="description" content="До настоящего момента я особо не сталкивался с задачами визуализации сложных эффектов, в целом все сводилось к примитивным анимациям, но в текущем проекте нужны были различные эффекты, сложность которых заранее не была известна. Мы задумались над концепцией разделения визуализации и программирования, чтобы мне не делать лишнюю работу. Вот тут то я впервые и столкнулся использованием частиц. Погуглив некоторое время, я пришел к выводу, что мне необходим редактор частиц и библиотека их визуализации, совместимая с OpenGL ES 2.0, интеграция которой в движок пройдет с наименьшими трудозатратами. Согласитесь, ведь это удобно иметь возможность настроить все параметры эффекта и в пару кликов интегрировать его в игру. Итак, я посоветовался с коллегами, они посоветовали посмотреть в сторону Particle Deisgner от 71Squared и Magic Particles от Astralax.  Particle Designer Particle Designer выглядел довольно соблазнительно, к тому же я уже был знаком с их продуктом Glyph Designer. Из больших плюсов Particle Designer:   	внушительный список интеграции с популярными фреймворкам 	красивый и удобный дизайн 	приличная библиотека эффектов.  Из минусов:   	отсутствует информация о базовой интеграции с OpenGL (в нашем случае у нас был самописный движок на C++). 	DemoApp на сайте был на Objective C (для нас минус, так как ориентируемся мы на с++) 	Программа работает только под Mac.  В целом мне все понравилось и я был уже готов перепилить/нарыть версию для C++ и работать с ним, но в последний момент коллега все же настоял на Magic Particles.  Magic Particles Ну, скажу сразу прямо: я доволен что мы выбрали этот продукт. Поначалу возникли сложности, в частности с тем, что у MagicParticles был враппер под OpenGL fixed pipeline, что меня расстроило, и пришлось переписывать враппер на OpenGL ES 2.0. Не знаю как у других, но у меня возникают трудности при отладке OpenGL кода, так как не часто приходится писать OpenGL код, и, как обычно бывает, написал и забыл. О сложностях с OpenGL я расскажу в отдельной статье. Итак, пришлось писать враппер для iOS под OpenGL ES 2.0, это заняло не очень много времени, приблизительно пару дней. В ходе написания пришлось вникнуть в структуру работы библиотеки и параллельно консультироваться с автором продукта. На удивление, он оказался доброжелательным и общительным человеком и помогал по всем вопросам, возникающим у нас по работе библиотеки и программы. Кстати, после моего обращения автор программы посмотрел в сторону мобильных платформ и сделал новый враппер, поэтому, скорее всего, вам будет легче чем мне. Из плюсов отмечу:   	хорошая библиотека эффектов 	средства по оптимизации текстур 	широкий выбор настроек эффектов 	различные врапперы для отрисовки, из которых можно слепить, по сути что угодно 	компилируемый формат эффектов, все компилируется в один файл, в т.ч. и текстуры, что может повысить производительность  Из минусов:   	работает только под windows (особенно меня огорчило) 	после долгой работы редактор частиц начинает жутко тормозить 	некоторые настройки далеко не интуитивны  На что стоит обратить внимание Так получилось, что мы разрабатываем прототип игрушки на еще неоптимизированном движке, поэтому у нас присутствует довольно большое количество лишних прорисовок, да и вообще OpenGL вызовов. Я точно неуверен из-за этого ли, или по другим причинам  в игре изрядно упала производительность, когда мы начали использовать частицы, но проблема была и нам пришлось браться за оптимизацию. Тормоза сильно были заметны только на iPhone 4S (минимально мы на него ориентировались) на iPhone 5 было заметно намного меньше, но все таки жутко раздражало. Вообще автор программы написал неплохое руководство по оптимизации эмиттеров для игр, куда мне следовало бы посмотреть первым делом, тогда бы я возможно не столкнулся со следующими проблемами.  Размер текстур Да, да, первым делом мы уперлись именно в это, и это правда очень сильно влияет на скорость. Все просто:   чем больше соотношение размер частицы / размер текстуры, тем эффективнее будет прорисовка.  Еще удобно, что большинство эффектов не требуют изображений высокого качество, поэтому когда частицы больше размера текстуры и текстура растягивается, OpenGL размывает их и получается все довольно красиво. В идеале, если частица должна смотреться четко, то текстура должна быть размером 1:1.  Количество частиц По неопытности, создавая эффекты, мы хотели добиться максимально красивого визуального эффекта, не задумываясь как это будет отражаться на производительности, особенно на мобильных платформах, а они, как раз, сильно ограничены в ресурсах.   Используйте как можно меньшее количество частиц, позволяющее достигнуть приемлемого вида эффекта. Опыт показал, что уменьшение количества частиц зачастую практически не влияет на качество эффекта, но, соответственно, повышает производительность.  Прорисовка Разумеется, в моем случае, наибольшую эффективность имела оптимизация прорисовки эффектов. В нашей 2D игре все эффекты находятся на одном слое по отношению к зрителю, а также ресурсы эффектов находятся в одном атласе, поэтому первое что приходит в голову - это рисовать их в один проход, что и было сделано. Но я столкнулся с одной проблемой - один и тот же эффект может включать частицы с используемой интенсивностью и без нее, то есть разные частицы могут иметь разную glBlendFunc. В связи с этим я решил разделить эффекты на два слоя - без интенсивности и с интенсивностью, и рисовать их в два прохода, соответственно. Но это стало возможным только в рамках задач текущего проекта, так как в нем все эффекты не включали смешивания слоев с разными режимами блендинга. Саму прорисовку я так же оптимизировал, используя VAO, в итоге, все в совокупности дало резкий прирост производительности и нормальную скорость.  В итоге что дают нам частицы? Мы имеем возможность дизайнить эффекты в отдельном редакторе и в пару кликов встроить их в игру, не заморачиваясь с их отображением. Все сводится к тому, что мы просто запускаем эффект с нужным именем и в нужном месте, что, несомненно, избавляет нас от большого геморроя. Из минусов могу отметить только то, что используя такой подход, не получится добиться единообразия использования эффектов, например, с flash-версией игры. ">


  <meta name="author" content="Ivan Fateev">


<meta property="og:type" content="article">
<meta property="og:locale" content="ru">
<meta property="og:site_name" content="Fateev.pro">
<meta property="og:title" content="Particle эффекты в мобильных играх">
<meta property="og:url" content="https://fateev.pro/gamedev/particle-effekty-v-mobilnyx-igrax.html">


  <meta property="og:description" content="До настоящего момента я особо не сталкивался с задачами визуализации сложных эффектов, в целом все сводилось к примитивным анимациям, но в текущем проекте нужны были различные эффекты, сложность которых заранее не была известна. Мы задумались над концепцией разделения визуализации и программирования, чтобы мне не делать лишнюю работу. Вот тут то я впервые и столкнулся использованием частиц. Погуглив некоторое время, я пришел к выводу, что мне необходим редактор частиц и библиотека их визуализации, совместимая с OpenGL ES 2.0, интеграция которой в движок пройдет с наименьшими трудозатратами. Согласитесь, ведь это удобно иметь возможность настроить все параметры эффекта и в пару кликов интегрировать его в игру. Итак, я посоветовался с коллегами, они посоветовали посмотреть в сторону Particle Deisgner от 71Squared и Magic Particles от Astralax.  Particle Designer Particle Designer выглядел довольно соблазнительно, к тому же я уже был знаком с их продуктом Glyph Designer. Из больших плюсов Particle Designer:   	внушительный список интеграции с популярными фреймворкам 	красивый и удобный дизайн 	приличная библиотека эффектов.  Из минусов:   	отсутствует информация о базовой интеграции с OpenGL (в нашем случае у нас был самописный движок на C++). 	DemoApp на сайте был на Objective C (для нас минус, так как ориентируемся мы на с++) 	Программа работает только под Mac.  В целом мне все понравилось и я был уже готов перепилить/нарыть версию для C++ и работать с ним, но в последний момент коллега все же настоял на Magic Particles.  Magic Particles Ну, скажу сразу прямо: я доволен что мы выбрали этот продукт. Поначалу возникли сложности, в частности с тем, что у MagicParticles был враппер под OpenGL fixed pipeline, что меня расстроило, и пришлось переписывать враппер на OpenGL ES 2.0. Не знаю как у других, но у меня возникают трудности при отладке OpenGL кода, так как не часто приходится писать OpenGL код, и, как обычно бывает, написал и забыл. О сложностях с OpenGL я расскажу в отдельной статье. Итак, пришлось писать враппер для iOS под OpenGL ES 2.0, это заняло не очень много времени, приблизительно пару дней. В ходе написания пришлось вникнуть в структуру работы библиотеки и параллельно консультироваться с автором продукта. На удивление, он оказался доброжелательным и общительным человеком и помогал по всем вопросам, возникающим у нас по работе библиотеки и программы. Кстати, после моего обращения автор программы посмотрел в сторону мобильных платформ и сделал новый враппер, поэтому, скорее всего, вам будет легче чем мне. Из плюсов отмечу:   	хорошая библиотека эффектов 	средства по оптимизации текстур 	широкий выбор настроек эффектов 	различные врапперы для отрисовки, из которых можно слепить, по сути что угодно 	компилируемый формат эффектов, все компилируется в один файл, в т.ч. и текстуры, что может повысить производительность  Из минусов:   	работает только под windows (особенно меня огорчило) 	после долгой работы редактор частиц начинает жутко тормозить 	некоторые настройки далеко не интуитивны  На что стоит обратить внимание Так получилось, что мы разрабатываем прототип игрушки на еще неоптимизированном движке, поэтому у нас присутствует довольно большое количество лишних прорисовок, да и вообще OpenGL вызовов. Я точно неуверен из-за этого ли, или по другим причинам  в игре изрядно упала производительность, когда мы начали использовать частицы, но проблема была и нам пришлось браться за оптимизацию. Тормоза сильно были заметны только на iPhone 4S (минимально мы на него ориентировались) на iPhone 5 было заметно намного меньше, но все таки жутко раздражало. Вообще автор программы написал неплохое руководство по оптимизации эмиттеров для игр, куда мне следовало бы посмотреть первым делом, тогда бы я возможно не столкнулся со следующими проблемами.  Размер текстур Да, да, первым делом мы уперлись именно в это, и это правда очень сильно влияет на скорость. Все просто:   чем больше соотношение размер частицы / размер текстуры, тем эффективнее будет прорисовка.  Еще удобно, что большинство эффектов не требуют изображений высокого качество, поэтому когда частицы больше размера текстуры и текстура растягивается, OpenGL размывает их и получается все довольно красиво. В идеале, если частица должна смотреться четко, то текстура должна быть размером 1:1.  Количество частиц По неопытности, создавая эффекты, мы хотели добиться максимально красивого визуального эффекта, не задумываясь как это будет отражаться на производительности, особенно на мобильных платформах, а они, как раз, сильно ограничены в ресурсах.   Используйте как можно меньшее количество частиц, позволяющее достигнуть приемлемого вида эффекта. Опыт показал, что уменьшение количества частиц зачастую практически не влияет на качество эффекта, но, соответственно, повышает производительность.  Прорисовка Разумеется, в моем случае, наибольшую эффективность имела оптимизация прорисовки эффектов. В нашей 2D игре все эффекты находятся на одном слое по отношению к зрителю, а также ресурсы эффектов находятся в одном атласе, поэтому первое что приходит в голову - это рисовать их в один проход, что и было сделано. Но я столкнулся с одной проблемой - один и тот же эффект может включать частицы с используемой интенсивностью и без нее, то есть разные частицы могут иметь разную glBlendFunc. В связи с этим я решил разделить эффекты на два слоя - без интенсивности и с интенсивностью, и рисовать их в два прохода, соответственно. Но это стало возможным только в рамках задач текущего проекта, так как в нем все эффекты не включали смешивания слоев с разными режимами блендинга. Саму прорисовку я так же оптимизировал, используя VAO, в итоге, все в совокупности дало резкий прирост производительности и нормальную скорость.  В итоге что дают нам частицы? Мы имеем возможность дизайнить эффекты в отдельном редакторе и в пару кликов встроить их в игру, не заморачиваясь с их отображением. Все сводится к тому, что мы просто запускаем эффект с нужным именем и в нужном месте, что, несомненно, избавляет нас от большого геморроя. Из минусов могу отметить только то, что используя такой подход, не получится добиться единообразия использования эффектов, например, с flash-версией игры. ">



  <meta property="og:image" content="https://fateev.pro/wp-content/uploads/2013/09/fig9.png">





  <meta property="article:published_time" content="2013-09-07T11:53:42-05:00">





  

  


<link rel="canonical" href="https://fateev.pro/gamedev/particle-effekty-v-mobilnyx-igrax.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Ivan Fateev",
      "url": "https://fateev.pro/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Fateev.pro Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/assets/js/headerPixels.js"></script>
  


    <!-- custom -->
<link rel="icon" type="image/png" href="/wp-content/uploads/2012/09/favicon.png">
<meta data-rh="true" property="al:android:app_name" content="Medium" />

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(16940533, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/16940533" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Fateev.pro
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Категории статей</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Теги</a>
            </li><li class="masthead__menu-item">
              <a href="https://fateev.studio/?utm_source=blog">Услуги</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">Обо мне</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Выпадающее меню</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/wp-content/uploads/2012/09/IMG_9760_final_bw-300x300.jpg" alt="Ivan Fateev" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Ivan Fateev</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software engineer with more <br />than 10 years of experience</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Связаться со мной</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://github.com/PoisonousJohn" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/poisonousjohn/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://teleg.run/poisonous_john" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-telegram" aria-hidden="true"></i> Telegram</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Particle эффекты в мобильных играх">
    <meta itemprop="description" content="До настоящего момента я особо не сталкивался с задачами визуализации сложных эффектов, в целом все сводилось к примитивным анимациям, но в текущем проекте нужны были различные эффекты, сложность которых заранее не была известна. Мы задумались над концепцией разделения визуализации и программирования, чтобы мне не делать лишнюю работу. Вот тут то я впервые и столкнулся использованием частиц.Погуглив некоторое время, я пришел к выводу, что мне необходим редактор частиц и библиотека их визуализации, совместимая с OpenGL ES 2.0, интеграция которой в движок пройдет с наименьшими трудозатратами. Согласитесь, ведь это удобно иметь возможность настроить все параметры эффекта и в пару кликов интегрировать его в игру.Итак, я посоветовался с коллегами, они посоветовали посмотреть в сторону Particle Deisgner от 71Squared и Magic Particles от Astralax.Particle DesignerParticle Designer выглядел довольно соблазнительно, к тому же я уже был знаком с их продуктом Glyph Designer.Из больших плюсов Particle Designer:	внушительный список интеграции с популярными фреймворкам	красивый и удобный дизайн	приличная библиотека эффектов.Из минусов:	отсутствует информация о базовой интеграции с OpenGL (в нашем случае у нас был самописный движок на C++).	DemoApp на сайте был на Objective C (для нас минус, так как ориентируемся мы на с++)	Программа работает только под Mac.В целом мне все понравилось и я был уже готов перепилить/нарыть версию для C++ и работать с ним, но в последний момент коллега все же настоял на Magic Particles.Magic ParticlesНу, скажу сразу прямо: я доволен что мы выбрали этот продукт. Поначалу возникли сложности, в частности с тем, что у MagicParticles был враппер под OpenGL fixed pipeline, что меня расстроило, и пришлось переписывать враппер на OpenGL ES 2.0. Не знаю как у других, но у меня возникают трудности при отладке OpenGL кода, так как не часто приходится писать OpenGL код, и, как обычно бывает, написал и забыл. О сложностях с OpenGL я расскажу в отдельной статье.Итак, пришлось писать враппер для iOS под OpenGL ES 2.0, это заняло не очень много времени, приблизительно пару дней. В ходе написания пришлось вникнуть в структуру работы библиотеки и параллельно консультироваться с автором продукта. На удивление, он оказался доброжелательным и общительным человеком и помогал по всем вопросам, возникающим у нас по работе библиотеки и программы.Кстати, после моего обращения автор программы посмотрел в сторону мобильных платформ и сделал новый враппер, поэтому, скорее всего, вам будет легче чем мне.Из плюсов отмечу:	хорошая библиотека эффектов	средства по оптимизации текстур	широкий выбор настроек эффектов	различные врапперы для отрисовки, из которых можно слепить, по сути что угодно	компилируемый формат эффектов, все компилируется в один файл, в т.ч. и текстуры, что может повысить производительностьИз минусов:	работает только под windows (особенно меня огорчило)	после долгой работы редактор частиц начинает жутко тормозить	некоторые настройки далеко не интуитивныНа что стоит обратить вниманиеТак получилось, что мы разрабатываем прототип игрушки на еще неоптимизированном движке, поэтому у нас присутствует довольно большое количество лишних прорисовок, да и вообще OpenGL вызовов. Я точно неуверен из-за этого ли, или по другим причинам  в игре изрядно упала производительность, когда мы начали использовать частицы, но проблема была и нам пришлось браться за оптимизацию.Тормоза сильно были заметны только на iPhone 4S (минимально мы на него ориентировались) на iPhone 5 было заметно намного меньше, но все таки жутко раздражало. Вообще автор программы написал неплохое руководство по оптимизации эмиттеров для игр, куда мне следовало бы посмотреть первым делом, тогда бы я возможно не столкнулся со следующими проблемами.Размер текстурДа, да, первым делом мы уперлись именно в это, и это правда очень сильно влияет на скорость. Все просто:чем больше соотношение размер частицы / размер текстуры, тем эффективнее будет прорисовка.Еще удобно, что большинство эффектов не требуют изображений высокого качество, поэтому когда частицы больше размера текстуры и текстура растягивается, OpenGL размывает их и получается все довольно красиво. В идеале, если частица должна смотреться четко, то текстура должна быть размером 1:1.Количество частицПо неопытности, создавая эффекты, мы хотели добиться максимально красивого визуального эффекта, не задумываясь как это будет отражаться на производительности, особенно на мобильных платформах, а они, как раз, сильно ограничены в ресурсах.Используйте как можно меньшее количество частиц, позволяющее достигнуть приемлемого вида эффекта. Опыт показал, что уменьшение количества частиц зачастую практически не влияет на качество эффекта, но, соответственно, повышает производительность.ПрорисовкаРазумеется, в моем случае, наибольшую эффективность имела оптимизация прорисовки эффектов. В нашей 2D игре все эффекты находятся на одном слое по отношению к зрителю, а также ресурсы эффектов находятся в одном атласе, поэтому первое что приходит в голову - это рисовать их в один проход, что и было сделано. Но я столкнулся с одной проблемой - один и тот же эффект может включать частицы с используемой интенсивностью и без нее, то есть разные частицы могут иметь разную glBlendFunc.В связи с этим я решил разделить эффекты на два слоя - без интенсивности и с интенсивностью, и рисовать их в два прохода, соответственно. Но это стало возможным только в рамках задач текущего проекта, так как в нем все эффекты не включали смешивания слоев с разными режимами блендинга. Саму прорисовку я так же оптимизировал, используя VAO, в итоге, все в совокупности дало резкий прирост производительности и нормальную скорость.В итоге что дают нам частицы?Мы имеем возможность дизайнить эффекты в отдельном редакторе и в пару кликов встроить их в игру, не заморачиваясь с их отображением. Все сводится к тому, что мы просто запускаем эффект с нужным именем и в нужном месте, что, несомненно, избавляет нас от большого геморроя.Из минусов могу отметить только то, что используя такой подход, не получится добиться единообразия использования эффектов, например, с flash-версией игры.">
    <meta itemprop="datePublished" content="2013-09-07T11:53:42-05:00">
    

    <div class="page__inner-wrap">
        <header >
          <h1 id="page-title" class="page__title" itemprop="headline">Particle эффекты в мобильных играх
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 мин на чтение

</p>
          
        </header>

      <section class="page__content" itemprop="text">
        
        <p dir="ltr"><a href="http://fateev.pro/wp-content/uploads/2013/09/fig9.png"><img class="alignleft size-medium wp-image-230" title="fig9" src="http://fateev.pro/wp-content/uploads/2013/09/fig9-300x226.png" alt="" width="300" height="226" /></a>До настоящего момента я особо не сталкивался с задачами визуализации сложных эффектов, в целом все сводилось к примитивным анимациям, но в текущем проекте нужны были различные эффекты, сложность которых заранее не была известна. Мы задумались над концепцией разделения визуализации и программирования, чтобы мне не делать лишнюю работу. Вот тут то я впервые и столкнулся использованием частиц.</p>
<p dir="ltr">Погуглив некоторое время, я пришел к выводу, что мне необходим редактор частиц и библиотека их визуализации, совместимая с OpenGL ES 2.0, интеграция которой в движок пройдет с наименьшими трудозатратами. Согласитесь, ведь это удобно иметь возможность настроить все параметры эффекта и в пару кликов интегрировать его в игру.</p>
<p dir="ltr">Итак, я посоветовался с коллегами, они посоветовали посмотреть в сторону Particle Deisgner от 71Squared и Magic Particles от Astralax.</p>

<h2 dir="ltr">Particle Designer</h2>
<p dir="ltr"><a href="http://fateev.pro/wp-content/uploads/2013/09/particle_settings_example.png"><img class="size-medium wp-image-242 alignright" title="particle_settings_example" src="http://fateev.pro/wp-content/uploads/2013/09/particle_settings_example-300x170.png" alt="" width="300" height="170" /></a>Particle Designer выглядел довольно соблазнительно, к тому же я уже был знаком с их продуктом Glyph Designer.</p>
<p dir="ltr"><strong>Из больших плюсов Particle Designer</strong>:</p>

<ol>
	<li>внушительный список интеграции с популярными фреймворкам</li>
	<li>красивый и удобный дизайн</li>
	<li>приличная библиотека эффектов.</li>
</ol>
<p dir="ltr"><strong>Из минусов</strong>:</p>

<ol>
	<li>отсутствует информация о базовой интеграции с OpenGL (в нашем случае у нас был самописный движок на C++).</li>
	<li>DemoApp на сайте был на Objective C (для нас минус, так как ориентируемся мы на с++)</li>
	<li>Программа работает только под Mac.</li>
</ol>
<p dir="ltr">В целом мне все понравилось и я был уже готов перепилить/нарыть версию для C++ и работать с ним, но в последний момент коллега все же настоял на Magic Particles.</p>

<h2 dir="ltr">Magic Particles</h2>
<p dir="ltr"><a href="http://fateev.pro/wp-content/uploads/2013/09/mp_screen.gif"><img class="alignleft size-medium wp-image-244" title="mp_screen" src="http://fateev.pro/wp-content/uploads/2013/09/mp_screen-300x216.gif" alt="" width="300" height="216" /></a>Ну, скажу сразу прямо: я доволен что мы выбрали этот продукт. Поначалу возникли сложности, в частности с тем, что у MagicParticles был враппер под OpenGL fixed pipeline, что меня расстроило, и пришлось переписывать враппер на OpenGL ES 2.0. Не знаю как у других, но у меня возникают трудности при отладке OpenGL кода, так как не часто приходится писать OpenGL код, и, как обычно бывает, написал и забыл. О сложностях с OpenGL я расскажу в отдельной статье.</p>
<p dir="ltr">Итак, пришлось писать враппер для iOS под OpenGL ES 2.0, это заняло не очень много времени, приблизительно пару дней. В ходе написания пришлось вникнуть в структуру работы библиотеки и параллельно консультироваться с автором продукта. На удивление, он оказался доброжелательным и общительным человеком и помогал по всем вопросам, возникающим у нас по работе библиотеки и программы.</p>
<p dir="ltr">Кстати, после моего обращения автор программы посмотрел в сторону мобильных платформ и сделал новый враппер, поэтому, скорее всего, вам будет легче чем мне.</p>
<p dir="ltr"><strong>Из плюсов отмечу</strong>:</p>

<ol>
	<li>хорошая библиотека эффектов</li>
	<li>средства по оптимизации текстур</li>
	<li>широкий выбор настроек эффектов</li>
	<li>различные врапперы для отрисовки, из которых можно слепить, по сути что угодно</li>
	<li>компилируемый формат эффектов, все компилируется в один файл, в т.ч. и текстуры, что может повысить производительность</li>
</ol>
<p dir="ltr"><strong>Из минусов</strong>:</p>

<ol>
	<li>работает только под windows (особенно меня огорчило)</li>
	<li>после долгой работы редактор частиц начинает жутко тормозить</li>
	<li>некоторые настройки далеко не интуитивны</li>
</ol>
<h2 dir="ltr">На что стоит обратить внимание</h2>
<p dir="ltr">Так получилось, что мы разрабатываем прототип игрушки на еще неоптимизированном движке, поэтому у нас присутствует довольно большое количество лишних прорисовок, да и вообще OpenGL вызовов. Я точно неуверен из-за этого ли, или по другим причинам  в игре изрядно упала производительность, когда мы начали использовать частицы, но проблема была и нам пришлось браться за оптимизацию.</p>
<p dir="ltr">Тормоза сильно были заметны только на iPhone 4S (минимально мы на него ориентировались) на iPhone 5 было заметно намного меньше, но все таки жутко раздражало. Вообще автор программы написал неплохое <a href="http://www.astralax.ru/articles/effects_optimization" rel="nofollow">руководство по оптимизации эмиттеров для игр</a>, куда мне следовало бы посмотреть первым делом, тогда бы я возможно не столкнулся со следующими проблемами.</p>

<h3 dir="ltr">Размер текстур</h3>
<p dir="ltr">Да, да, первым делом мы уперлись именно в это, и это правда очень сильно влияет на скорость. Все просто:</p>

<blockquote>
<p dir="ltr">чем больше соотношение размер частицы / размер текстуры, тем эффективнее будет прорисовка.</p>
</blockquote>
<p dir="ltr">Еще удобно, что большинство эффектов не требуют изображений высокого качество, поэтому когда частицы больше размера текстуры и текстура растягивается, OpenGL размывает их и получается все довольно красиво. В идеале, если частица должна смотреться четко, то текстура должна быть размером 1:1.</p>

<h3 dir="ltr">Количество частиц</h3>
<p dir="ltr">По неопытности, создавая эффекты, мы хотели добиться максимально красивого визуального эффекта, не задумываясь как это будет отражаться на производительности, особенно на мобильных платформах, а они, как раз, сильно ограничены в ресурсах.</p>

<blockquote>
<p dir="ltr">Используйте как можно меньшее количество частиц, позволяющее достигнуть приемлемого вида эффекта. Опыт показал, что уменьшение количества частиц зачастую практически не влияет на качество эффекта, но, соответственно, повышает производительность.</p>
</blockquote>
<h3 dir="ltr">Прорисовка</h3>
<p dir="ltr">Разумеется, в моем случае, наибольшую эффективность имела оптимизация прорисовки эффектов. В нашей 2D игре все эффекты находятся на одном слое по отношению к зрителю, а также ресурсы эффектов находятся в одном атласе, поэтому первое что приходит в голову - это рисовать их в один проход, что и было сделано. Но я столкнулся с одной проблемой - один и тот же эффект может включать частицы с используемой интенсивностью и без нее, то есть разные частицы могут иметь разную glBlendFunc.</p>
<p dir="ltr">В связи с этим я решил разделить эффекты на два слоя - без интенсивности и с интенсивностью, и рисовать их в два прохода, соответственно. Но это стало возможным только в рамках задач текущего проекта, так как в нем все эффекты не включали смешивания слоев с разными режимами блендинга. Саму прорисовку я так же оптимизировал, используя VAO, в итоге, все в совокупности дало резкий прирост производительности и нормальную скорость.</p>

<h3 dir="ltr">В итоге что дают нам частицы?</h3>
<p dir="ltr">Мы имеем возможность дизайнить эффекты в отдельном редакторе и в пару кликов встроить их в игру, не заморачиваясь с их отображением. Все сводится к тому, что мы просто запускаем эффект с нужным именем и в нужном месте, что, несомненно, избавляет нас от большого геморроя.</p>
<p>Из минусов могу отметить только то, что используя такой подход, не получится добиться единообразия использования эффектов, например, с flash-версией игры.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Метки: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/experience" class="page__taxonomy-item" rel="tag">experience</a><span class="sep">, </span>
    
      
      
      <a href="/tags/gamedev" class="page__taxonomy-item" rel="tag">gamedev</a><span class="sep">, </span>
    
      
      
      <a href="/tags/mobile" class="page__taxonomy-item" rel="tag">mobile</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Разделы: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/gamedev" class="page__taxonomy-item" rel="tag">Gamedev</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Дата изменения:</strong> <time datetime="2013-09-07T11:53:42-05:00">September 7, 2013</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Поделиться</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Particle+%D1%8D%D1%84%D1%84%D0%B5%D0%BA%D1%82%D1%8B+%D0%B2+%D0%BC%D0%BE%D0%B1%D0%B8%D0%BB%D1%8C%D0%BD%D1%8B%D1%85+%D0%B8%D0%B3%D1%80%D0%B0%D1%85%20https%3A%2F%2Ffateev.pro%2Fgamedev%2Fparticle-effekty-v-mobilnyx-igrax.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ffateev.pro%2Fgamedev%2Fparticle-effekty-v-mobilnyx-igrax.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Ffateev.pro%2Fgamedev%2Fparticle-effekty-v-mobilnyx-igrax.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/dev-tools/udalit-clrf-iz-fajla.html" class="pagination--pager" title="Удалить CLRF из файла
">Предыдущая</a>
    
    
      <a href="/chronicles/lyubiteli-velosipedov.html" class="pagination--pager" title="Любители велосипедов
">Следующая</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">Вам также может понравиться</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/bug-prioritization-matrix.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/startup-challenges/ensuring-the-quality-appium.html" rel="permalink">Startup challenges: Lost bugs, anxiety and burnout
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Bugs in your company get lost in the chat, users leave, management blames engineers, engineers feel guilty and anxious, get burned out? We’ve been there. Her...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/testing-pyramid.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/startup-challenges/ensuring-the-quality-appium.html" rel="permalink">Startup challenges: Ensuring the quality with Appium
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">One of the main challenges in our startup is to ensure that our product is of good quality. We decided to try Appium to test end-to-end scenarios.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/abstract-code.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/programming/how-to-clean-a-legacy-code-stop-complaining-start-doing.html" rel="permalink">How to clean a legacy code: stop complaining, start doing
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Most of the articles and books tell you how to write a “good code”. But in real life, you often find yourself deep in the shit after joining some company or ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/growing_junior.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ru/programming/are-you-growing-your-juniors-right.html" rel="permalink">Правильно ли вы растите своих джунов?
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">У меня есть ученик. В начале его пути я помогал ему постичь наше ремесло, потом он попал в одну крупную компанию. Что с ним там сделали, вы не поверите…
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Связаться со мной:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> RSS-лента</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Ivan Fateev. Сайт работает на <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  
    <script src="/assets/js/main.min.js"></script>
  
    <script src="/assets/js/footerPixels.js"></script>
  
    <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  










  </body>
</html>
