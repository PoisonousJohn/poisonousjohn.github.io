<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ru" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Архитектура Sonata Admin Bundle - Fateev.pro</title>
<meta name="description" content="Sonata Admin Bundle, как и вся концепция symfony2 поддерживает сервисно-ориентированную архитектуру, поэтому, чтобы сделать CRUD для сущности, в первую очередь, необходимо создать определенный сервис.   Приведу пример сервиса в моем проекте:  services:      mtools.budget.expense.admin:          id: mtools.budget.expense.admin          class: Mtools\BudgetBundle\Admin\BudgetExpenseAdmin          tags:              - { name: sonata.admin, manager_type: orm, group: budget, label: Расходная cмета }          arguments: [null, Mtools\BudgetBundle\Entity\BudgetExpense, MtoolsBudgetBundle:BudgetExpenseAdmin&amp;nbsp;]  Итак, по порядку:  	mtools.budget.expense.admin - выступает в качестве родительского id сервиса, на следующей строчке, я все же явно указываю, что это id сервиса 	class - это админ класс для вашей сущности, должен быть наследником&nbsp;Sonata\AdminBundle\Admin\Admin 	tags - теги, по которым соната определяет, что этот сервис принадлежит ей. Обращу внимание на то, что group действителен только в том случае, если в конфигурации сонаты вы явно не указывает список групп, которые должны выводиться в dashboard; label - фактически, это имя сущности, которое будет выводиться в dashboard 	arguments - первый аргумент... честно говоря хз что это, второй аргумент - это класс сущности, которую мы редактируем, третий аргумент - это класс контроллера, который будет обслуживать нашу сущность, должен быть &nbsp;наследником&nbsp;Sonata\AdminBundle\Controller\CRUDController  Теперь рассмотрим архитектуру админ класса. Так как основная задача админгенератора, обеспечить CRUD, то, соответственно, все архитектура завязана вокруг этих действий. Основными являются три метода для настройки админ класса:  	configureFormFields - в данном методе мы настраиваем вид формы для редактирования нашей сущности 	configureListFields - этот метод определяет набор колонок, которые будут отображены при выводе списка сущностей для редактирования 	configureDatagridFilters - а в этом методе мы определяем набор фильтров, которые мы сможем использовать для поиска по сущностям (Более подробная информация о фильтрах) 	configureRoutes - соната динамически генерирует роуты для сущностей, с помощью этого метода можно управлять как уже сгенерированными роутами для CRUD&#39;a (create, edit, delete), так и добавить свои роуты, например для произвольной страницы  Вцелом, принцип настройки админ класса сходен для всех трех методов, но есть и свои особенности. В простейшем виде метод может выглядеть следующим обарзом:  &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         ...         $formMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ;         ...  Мы используем метод add класса FormMapper, чтобы добавить в форму поле для редактирования названия сущности. Первый аргумент  - идентификатор поля сущности, второй (чаще всего будет null) - тип поля формы, соната, чаще всего, без проблем определяет тип поля автоматически и подбирает соответствующий тип поля формы, третий - список опции для поля. Замечу то, что соната позволяет использовать стандартные типы полей формы symfony2, а это дает возможность очень гибко строить кастомные формы. В дальнеших статьях я расскажу о том как сделать свой тип поля, а также расскажу о готовых решениях. Для связных сущностей, возможно, придется явно указывать тип поля sonata_type_model, у которого есть довольно удобная опция edit =&gt; ‘list’, позволяющая производить создание и поиск нужной сущности прямо в попапе. Хотя, конечно, на тот момент, когда я использовал эту фишку, она была довольно сырой и было несколько неприятных багов, вроде того, что нужно инициализировать кастомные js скрипты специально для попапа, поэтому я стал использовать немного другое решение, но об этом в другой статье.  Пример поля sonata_type_model с опцией edit =&gt; ‘list’:  &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         $formMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))             -&gt;add(&#39;subProject&#39;, &#39;sonata_type_model&#39;, array(&#39;label&#39; =&gt; &#39;Подпроект&#39;), array(&#39;edit&#39; =&gt; &#39;list&#39;))  Выглядит это примерно так:     Полный список типов полей, доступных в сонате, можно посмотреть в файле сервисов Sonata/AdminBundle/Resources/config/form_types.xml Метод configureListFields, очень похож на configureFormFields, но в нем есть дополнительный метод addIdentifier, который добавляет не только колонку со значением поля, но и делает эту колонку ссылкой для редактирования сущности, если вы опустите это поле, то просто не сможете отредактировать вашу сущность. Вот пример метода:  &lt;?php     protected function configureListFields(ListMapper $listMapper)     {         ...         $listMapper             -&gt;addIdentifier(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ...  Обратите внимание, что в configureFormFields НЕ НУЖНО использовать sonata_type_model, Sonata сама должна определить тип поля и вывести соответствующее значение. Кстати значение связных сущностей выводится из метода __toString(), поэтому если вы выводите связные сущности в списке, этот метод обязателен для реализации  Метод configureDatagridFields немного более сложный, хотя схож с предыдущими. Пример:  &lt;?php     protected function configureDatagridFilters(DatagridMapper $datagridMapper)     {         $datagridMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ;     }  Не смотря на то, что вид метода add такой же, как и прошлых, он в корне отличается от них. Второй параметр - это не тип поля, а тип фильтра, фактически он определяет то, как поле будет фильтроваться в базе. Сам тип поля формы в фильтре, а также его опции - это, соответственно, четвертый и пятый параметры, принцип у них такой же, как и в двух предыдущих методых. Тип фильтра, по умолчанию, ставьте null, Sonata чаще всего сама легко определяет нужный, но, если что, список доступных типов фильтра можно посмотреть в файле Sonata/DoctrineOMRAdminBundle/Resources/config/doctrine_orm_filter_types.xml Что касается метода configureRoutes, то его можно использовать, к примеру, чтобы запретить какое либо из действий для сущности:  &lt;?php     protected function configureRoutes(RouteCollection $collection)     {         $collection-&gt;remove(&#39;create&#39;);     }  Данный код запрещает создание новых сущностей. Соната сама скроет все ссылки на создание новой сущности. Более подробно про configureRoutes рассказано здесь.  В админ классе есть методы-события, связанные с CRUD’ами: prePersist, postPersist, preUpdate, postUpdate, preRemove, postRemove. Эти методы, в качестве единственного аргумента, получают редактируемый/создаваемый нами объект/ В большинстве случаев, этих методов вполне достаточно, чтобы обслужить создание/обновление/удаление объекта.  После того как вы закончите с админ классом и опишите новый сервис, если у вас конфигурация админ бандла по умолчанию, то в dashboard появится новый пункт для редактирования вашей сущности. Это происходит автоматически, соната определяет нужные сервисы по тегу sonata.admin.  Если нужно выводить конкретную структуру админ сервисов в dashboard, то для этого предусмотрена определенная конфигурация админ бандла:  sonata_admin:      dashboard:          groups:              sonata_user:                  label: Пользователи                  items:                     - sonata.user.admin.user  sonata.user.admin.user - здесь, соответственно, id сервиса, который попадет в группу, sonata_user произвольный, уникальный идентификатор группы, label - имя группы, которое будет отображаться в dashboard’e  Приведу несколько трюков, которые могут пригодиться:     Вывести разный набор полей, в зависимости от того, редактируем мы сущность или создаем   &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         $formMapper             -&gt;with(&#39;Подпроект&#39;)                 -&gt;add(&#39;title&#39;, null, array(                     &#39;label&#39; =&gt; &#39;Название&#39;,                 ))         ;          if ($this-&gt;getSubject()-&gt;getId()) {             //если мы редактируем объект              $formMapper-&gt;add(&#39;description&#39;, null, array(&#39;label&#39; =&gt; &#39;Описание&#39;));         }          $formMapper -&gt;end();  При создании новой сущности Sonata создает пустой объект этой сущности, а при редактировании, получает его из базы. Этот объект мы получаем посредством метода getSubject(), и, если у объект есть id, то значит, что он уже есть в базе, а, следовательно, мы редактируем объект.  Также здесь присутствуют два неупомянутых методы with() и end(). Они позволяют группировать поля в fieldset.     Этот же трюк можно использовать, чтобы устанавливать значения полей по умолчанию:   &lt;?php         if (!$this-&gt;getSubject()-&gt;getId()) {                 $this-&gt;getSubject()-&gt;setSomeValue($someValue);         }     Для работы с другими сущностями вам может понадобиться получить  entityManager:   &lt;?php         $em = $this-&gt;getModelManager()-&gt;getEntityManager($this-&gt;getSubject());  Обратите внимание, что getEntityManager принимает в качестве параметра объект (например тот, который мы редактируем)    Соната довольно логично использует шаблонизатор, поэтому переопределить шаблон того или иного action’a (edit, list) довольно просто. Сначала вам необходимо создать шаблон и унаследовать его от сонатовского:   \{\% extends &#39;SonataAdminBundle:CRUD:base_list.html.twig&#39; %}  Затем, в шаблоне переопределите соответствующие блоки. Финальный шаг - указать админ классу, какой шаблон нужно использовать для action’a. Я это делал, вызывая метод setTemplate внутри метода configureFormFields, хотя можно было бы придумать и более изящный способ:      protected function configureFormFields(FormMapper $formMapper)     {          $this-&gt;setTemplate(&#39;edit&#39;, &#39;SonataTemplatesBundle:Default:edit_with_top_actions.html.twig&#39;);  Ну вот, думаю на этом все =) надеюсь эта информация будет вам полезна, дерзайте. ">


  <meta name="author" content="Ivan Fateev">


<meta property="og:type" content="article">
<meta property="og:locale" content="ru">
<meta property="og:site_name" content="Fateev.pro">
<meta property="og:title" content="Архитектура Sonata Admin Bundle">
<meta property="og:url" content="https://fateev.pro/symfony-sonata/arxitektura-sonata-admin-bundle.html">


  <meta property="og:description" content="Sonata Admin Bundle, как и вся концепция symfony2 поддерживает сервисно-ориентированную архитектуру, поэтому, чтобы сделать CRUD для сущности, в первую очередь, необходимо создать определенный сервис.   Приведу пример сервиса в моем проекте:  services:      mtools.budget.expense.admin:          id: mtools.budget.expense.admin          class: Mtools\BudgetBundle\Admin\BudgetExpenseAdmin          tags:              - { name: sonata.admin, manager_type: orm, group: budget, label: Расходная cмета }          arguments: [null, Mtools\BudgetBundle\Entity\BudgetExpense, MtoolsBudgetBundle:BudgetExpenseAdmin&amp;nbsp;]  Итак, по порядку:  	mtools.budget.expense.admin - выступает в качестве родительского id сервиса, на следующей строчке, я все же явно указываю, что это id сервиса 	class - это админ класс для вашей сущности, должен быть наследником&nbsp;Sonata\AdminBundle\Admin\Admin 	tags - теги, по которым соната определяет, что этот сервис принадлежит ей. Обращу внимание на то, что group действителен только в том случае, если в конфигурации сонаты вы явно не указывает список групп, которые должны выводиться в dashboard; label - фактически, это имя сущности, которое будет выводиться в dashboard 	arguments - первый аргумент... честно говоря хз что это, второй аргумент - это класс сущности, которую мы редактируем, третий аргумент - это класс контроллера, который будет обслуживать нашу сущность, должен быть &nbsp;наследником&nbsp;Sonata\AdminBundle\Controller\CRUDController  Теперь рассмотрим архитектуру админ класса. Так как основная задача админгенератора, обеспечить CRUD, то, соответственно, все архитектура завязана вокруг этих действий. Основными являются три метода для настройки админ класса:  	configureFormFields - в данном методе мы настраиваем вид формы для редактирования нашей сущности 	configureListFields - этот метод определяет набор колонок, которые будут отображены при выводе списка сущностей для редактирования 	configureDatagridFilters - а в этом методе мы определяем набор фильтров, которые мы сможем использовать для поиска по сущностям (Более подробная информация о фильтрах) 	configureRoutes - соната динамически генерирует роуты для сущностей, с помощью этого метода можно управлять как уже сгенерированными роутами для CRUD&#39;a (create, edit, delete), так и добавить свои роуты, например для произвольной страницы  Вцелом, принцип настройки админ класса сходен для всех трех методов, но есть и свои особенности. В простейшем виде метод может выглядеть следующим обарзом:  &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         ...         $formMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ;         ...  Мы используем метод add класса FormMapper, чтобы добавить в форму поле для редактирования названия сущности. Первый аргумент  - идентификатор поля сущности, второй (чаще всего будет null) - тип поля формы, соната, чаще всего, без проблем определяет тип поля автоматически и подбирает соответствующий тип поля формы, третий - список опции для поля. Замечу то, что соната позволяет использовать стандартные типы полей формы symfony2, а это дает возможность очень гибко строить кастомные формы. В дальнеших статьях я расскажу о том как сделать свой тип поля, а также расскажу о готовых решениях. Для связных сущностей, возможно, придется явно указывать тип поля sonata_type_model, у которого есть довольно удобная опция edit =&gt; ‘list’, позволяющая производить создание и поиск нужной сущности прямо в попапе. Хотя, конечно, на тот момент, когда я использовал эту фишку, она была довольно сырой и было несколько неприятных багов, вроде того, что нужно инициализировать кастомные js скрипты специально для попапа, поэтому я стал использовать немного другое решение, но об этом в другой статье.  Пример поля sonata_type_model с опцией edit =&gt; ‘list’:  &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         $formMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))             -&gt;add(&#39;subProject&#39;, &#39;sonata_type_model&#39;, array(&#39;label&#39; =&gt; &#39;Подпроект&#39;), array(&#39;edit&#39; =&gt; &#39;list&#39;))  Выглядит это примерно так:     Полный список типов полей, доступных в сонате, можно посмотреть в файле сервисов Sonata/AdminBundle/Resources/config/form_types.xml Метод configureListFields, очень похож на configureFormFields, но в нем есть дополнительный метод addIdentifier, который добавляет не только колонку со значением поля, но и делает эту колонку ссылкой для редактирования сущности, если вы опустите это поле, то просто не сможете отредактировать вашу сущность. Вот пример метода:  &lt;?php     protected function configureListFields(ListMapper $listMapper)     {         ...         $listMapper             -&gt;addIdentifier(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ...  Обратите внимание, что в configureFormFields НЕ НУЖНО использовать sonata_type_model, Sonata сама должна определить тип поля и вывести соответствующее значение. Кстати значение связных сущностей выводится из метода __toString(), поэтому если вы выводите связные сущности в списке, этот метод обязателен для реализации  Метод configureDatagridFields немного более сложный, хотя схож с предыдущими. Пример:  &lt;?php     protected function configureDatagridFilters(DatagridMapper $datagridMapper)     {         $datagridMapper             -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))         ;     }  Не смотря на то, что вид метода add такой же, как и прошлых, он в корне отличается от них. Второй параметр - это не тип поля, а тип фильтра, фактически он определяет то, как поле будет фильтроваться в базе. Сам тип поля формы в фильтре, а также его опции - это, соответственно, четвертый и пятый параметры, принцип у них такой же, как и в двух предыдущих методых. Тип фильтра, по умолчанию, ставьте null, Sonata чаще всего сама легко определяет нужный, но, если что, список доступных типов фильтра можно посмотреть в файле Sonata/DoctrineOMRAdminBundle/Resources/config/doctrine_orm_filter_types.xml Что касается метода configureRoutes, то его можно использовать, к примеру, чтобы запретить какое либо из действий для сущности:  &lt;?php     protected function configureRoutes(RouteCollection $collection)     {         $collection-&gt;remove(&#39;create&#39;);     }  Данный код запрещает создание новых сущностей. Соната сама скроет все ссылки на создание новой сущности. Более подробно про configureRoutes рассказано здесь.  В админ классе есть методы-события, связанные с CRUD’ами: prePersist, postPersist, preUpdate, postUpdate, preRemove, postRemove. Эти методы, в качестве единственного аргумента, получают редактируемый/создаваемый нами объект/ В большинстве случаев, этих методов вполне достаточно, чтобы обслужить создание/обновление/удаление объекта.  После того как вы закончите с админ классом и опишите новый сервис, если у вас конфигурация админ бандла по умолчанию, то в dashboard появится новый пункт для редактирования вашей сущности. Это происходит автоматически, соната определяет нужные сервисы по тегу sonata.admin.  Если нужно выводить конкретную структуру админ сервисов в dashboard, то для этого предусмотрена определенная конфигурация админ бандла:  sonata_admin:      dashboard:          groups:              sonata_user:                  label: Пользователи                  items:                     - sonata.user.admin.user  sonata.user.admin.user - здесь, соответственно, id сервиса, который попадет в группу, sonata_user произвольный, уникальный идентификатор группы, label - имя группы, которое будет отображаться в dashboard’e  Приведу несколько трюков, которые могут пригодиться:     Вывести разный набор полей, в зависимости от того, редактируем мы сущность или создаем   &lt;?php     protected function configureFormFields(FormMapper $formMapper)     {         $formMapper             -&gt;with(&#39;Подпроект&#39;)                 -&gt;add(&#39;title&#39;, null, array(                     &#39;label&#39; =&gt; &#39;Название&#39;,                 ))         ;          if ($this-&gt;getSubject()-&gt;getId()) {             //если мы редактируем объект              $formMapper-&gt;add(&#39;description&#39;, null, array(&#39;label&#39; =&gt; &#39;Описание&#39;));         }          $formMapper -&gt;end();  При создании новой сущности Sonata создает пустой объект этой сущности, а при редактировании, получает его из базы. Этот объект мы получаем посредством метода getSubject(), и, если у объект есть id, то значит, что он уже есть в базе, а, следовательно, мы редактируем объект.  Также здесь присутствуют два неупомянутых методы with() и end(). Они позволяют группировать поля в fieldset.     Этот же трюк можно использовать, чтобы устанавливать значения полей по умолчанию:   &lt;?php         if (!$this-&gt;getSubject()-&gt;getId()) {                 $this-&gt;getSubject()-&gt;setSomeValue($someValue);         }     Для работы с другими сущностями вам может понадобиться получить  entityManager:   &lt;?php         $em = $this-&gt;getModelManager()-&gt;getEntityManager($this-&gt;getSubject());  Обратите внимание, что getEntityManager принимает в качестве параметра объект (например тот, который мы редактируем)    Соната довольно логично использует шаблонизатор, поэтому переопределить шаблон того или иного action’a (edit, list) довольно просто. Сначала вам необходимо создать шаблон и унаследовать его от сонатовского:   \{\% extends &#39;SonataAdminBundle:CRUD:base_list.html.twig&#39; %}  Затем, в шаблоне переопределите соответствующие блоки. Финальный шаг - указать админ классу, какой шаблон нужно использовать для action’a. Я это делал, вызывая метод setTemplate внутри метода configureFormFields, хотя можно было бы придумать и более изящный способ:      protected function configureFormFields(FormMapper $formMapper)     {          $this-&gt;setTemplate(&#39;edit&#39;, &#39;SonataTemplatesBundle:Default:edit_with_top_actions.html.twig&#39;);  Ну вот, думаю на этом все =) надеюсь эта информация будет вам полезна, дерзайте. ">



  <meta property="og:image" content="https://fateev.pro/wp-content/uploads/2012/09/sonata.jpg">





  <meta property="article:published_time" content="2012-09-02T11:35:47-05:00">





  

  


<link rel="canonical" href="https://fateev.pro/symfony-sonata/arxitektura-sonata-admin-bundle.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Ivan Fateev",
      "url": "https://fateev.pro/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Fateev.pro Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
    <script src="/assets/js/headerPixels.js"></script>
  


    <!-- custom -->
<link rel="icon" type="image/png" href="/wp-content/uploads/2012/09/favicon.png">
<meta data-rh="true" property="al:android:app_name" content="Medium" />

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(16940533, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/16940533" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Fateev.pro
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Категории статей</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Теги</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">Обо мне</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Выпадающее меню</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/wp-content/uploads/2012/09/IMG_9760_final_bw-300x300.jpg" alt="Ivan Fateev" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Ivan Fateev</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software engineer with more <br />than 10 years of experience</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Связаться со мной</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://github.com/PoisonousJohn" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/poisonousjohn/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://teleg.run/poisonous_john" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-telegram" aria-hidden="true"></i> Telegram</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Архитектура Sonata Admin Bundle">
    <meta itemprop="description" content="Sonata Admin Bundle, как и вся концепция symfony2 поддерживает сервисно-ориентированную архитектуру, поэтому, чтобы сделать CRUD для сущности, в первую очередь, необходимо создать определенный сервис.Приведу пример сервиса в моем проекте:services:    mtools.budget.expense.admin:        id: mtools.budget.expense.admin        class: Mtools\BudgetBundle\Admin\BudgetExpenseAdmin        tags:            - { name: sonata.admin, manager_type: orm, group: budget, label: Расходная cмета }        arguments: [null, Mtools\BudgetBundle\Entity\BudgetExpense, MtoolsBudgetBundle:BudgetExpenseAdmin&amp;nbsp;]Итак, по порядку:	mtools.budget.expense.admin - выступает в качестве родительского id сервиса, на следующей строчке, я все же явно указываю, что это id сервиса	class - это админ класс для вашей сущности, должен быть наследником&nbsp;Sonata\AdminBundle\Admin\Admin	tags - теги, по которым соната определяет, что этот сервис принадлежит ей. Обращу внимание на то, что group действителен только в том случае, если в конфигурации сонаты вы явно не указывает список групп, которые должны выводиться в dashboard; label - фактически, это имя сущности, которое будет выводиться в dashboard	arguments - первый аргумент... честно говоря хз что это, второй аргумент - это класс сущности, которую мы редактируем, третий аргумент - это класс контроллера, который будет обслуживать нашу сущность, должен быть &nbsp;наследником&nbsp;Sonata\AdminBundle\Controller\CRUDControllerТеперь рассмотрим архитектуру админ класса. Так как основная задача админгенератора, обеспечить CRUD, то, соответственно, все архитектура завязана вокруг этих действий. Основными являются три метода для настройки админ класса:	configureFormFields - в данном методе мы настраиваем вид формы для редактирования нашей сущности	configureListFields - этот метод определяет набор колонок, которые будут отображены при выводе списка сущностей для редактирования	configureDatagridFilters - а в этом методе мы определяем набор фильтров, которые мы сможем использовать для поиска по сущностям (Более подробная информация о фильтрах)	configureRoutes - соната динамически генерирует роуты для сущностей, с помощью этого метода можно управлять как уже сгенерированными роутами для CRUD&#39;a (create, edit, delete), так и добавить свои роуты, например для произвольной страницыВцелом, принцип настройки админ класса сходен для всех трех методов, но есть и свои особенности. В простейшем виде метод может выглядеть следующим обарзом:&lt;?php    protected function configureFormFields(FormMapper $formMapper)    {        ...        $formMapper            -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))        ;        ...Мы используем метод add класса FormMapper, чтобы добавить в форму поле для редактирования названия сущности. Первый аргумент  - идентификатор поля сущности, второй (чаще всего будет null) - тип поля формы, соната, чаще всего, без проблем определяет тип поля автоматически и подбирает соответствующий тип поля формы, третий - список опции для поля.Замечу то, что соната позволяет использовать стандартные типы полей формы symfony2, а это дает возможность очень гибко строить кастомные формы. В дальнеших статьях я расскажу о том как сделать свой тип поля, а также расскажу о готовых решениях.Для связных сущностей, возможно, придется явно указывать тип поля sonata_type_model, у которого есть довольно удобная опция edit =&gt; ‘list’, позволяющая производить создание и поиск нужной сущности прямо в попапе. Хотя, конечно, на тот момент, когда я использовал эту фишку, она была довольно сырой и было несколько неприятных багов, вроде того, что нужно инициализировать кастомные js скрипты специально для попапа, поэтому я стал использовать немного другое решение, но об этом в другой статье.Пример поля sonata_type_model с опцией edit =&gt; ‘list’:&lt;?php    protected function configureFormFields(FormMapper $formMapper)    {        $formMapper            -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))            -&gt;add(&#39;subProject&#39;, &#39;sonata_type_model&#39;, array(&#39;label&#39; =&gt; &#39;Подпроект&#39;), array(&#39;edit&#39; =&gt; &#39;list&#39;))Выглядит это примерно так:Полный список типов полей, доступных в сонате, можно посмотреть в файле сервисов Sonata/AdminBundle/Resources/config/form_types.xmlМетод configureListFields, очень похож на configureFormFields, но в нем есть дополнительный метод addIdentifier, который добавляет не только колонку со значением поля, но и делает эту колонку ссылкой для редактирования сущности, если вы опустите это поле, то просто не сможете отредактировать вашу сущность. Вот пример метода:&lt;?php    protected function configureListFields(ListMapper $listMapper)    {        ...        $listMapper            -&gt;addIdentifier(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))        ...Обратите внимание, что в configureFormFields НЕ НУЖНО использовать sonata_type_model, Sonata сама должна определить тип поля и вывести соответствующее значение. Кстати значение связных сущностей выводится из метода __toString(), поэтому если вы выводите связные сущности в списке, этот метод обязателен для реализации Метод configureDatagridFields немного более сложный, хотя схож с предыдущими. Пример:&lt;?php    protected function configureDatagridFilters(DatagridMapper $datagridMapper)    {        $datagridMapper            -&gt;add(&#39;title&#39;, null, array(&#39;label&#39; =&gt; &#39;Название&#39;))        ;    }Не смотря на то, что вид метода add такой же, как и прошлых, он в корне отличается от них. Второй параметр - это не тип поля, а тип фильтра, фактически он определяет то, как поле будет фильтроваться в базе. Сам тип поля формы в фильтре, а также его опции - это, соответственно, четвертый и пятый параметры, принцип у них такой же, как и в двух предыдущих методых.Тип фильтра, по умолчанию, ставьте null, Sonata чаще всего сама легко определяет нужный, но, если что, список доступных типов фильтра можно посмотреть в файле Sonata/DoctrineOMRAdminBundle/Resources/config/doctrine_orm_filter_types.xmlЧто касается метода configureRoutes, то его можно использовать, к примеру, чтобы запретить какое либо из действий для сущности:&lt;?php    protected function configureRoutes(RouteCollection $collection)    {        $collection-&gt;remove(&#39;create&#39;);    }Данный код запрещает создание новых сущностей. Соната сама скроет все ссылки на создание новой сущности. Более подробно про configureRoutes рассказано здесь.В админ классе есть методы-события, связанные с CRUD’ами: prePersist, postPersist, preUpdate, postUpdate, preRemove, postRemove. Эти методы, в качестве единственного аргумента, получают редактируемый/создаваемый нами объект/ В большинстве случаев, этих методов вполне достаточно, чтобы обслужить создание/обновление/удаление объекта.После того как вы закончите с админ классом и опишите новый сервис, если у вас конфигурация админ бандла по умолчанию, то в dashboard появится новый пункт для редактирования вашей сущности. Это происходит автоматически, соната определяет нужные сервисы по тегу sonata.admin.Если нужно выводить конкретную структуру админ сервисов в dashboard, то для этого предусмотрена определенная конфигурация админ бандла:sonata_admin:    dashboard:        groups:            sonata_user:                label: Пользователи                items:                   - sonata.user.admin.usersonata.user.admin.user - здесь, соответственно, id сервиса, который попадет в группу, sonata_user произвольный, уникальный идентификатор группы, label - имя группы, которое будет отображаться в dashboard’eПриведу несколько трюков, которые могут пригодиться:  Вывести разный набор полей, в зависимости от того, редактируем мы сущность или создаем&lt;?php    protected function configureFormFields(FormMapper $formMapper)    {        $formMapper            -&gt;with(&#39;Подпроект&#39;)                -&gt;add(&#39;title&#39;, null, array(                    &#39;label&#39; =&gt; &#39;Название&#39;,                ))        ;        if ($this-&gt;getSubject()-&gt;getId()) {            //если мы редактируем объект            $formMapper-&gt;add(&#39;description&#39;, null, array(&#39;label&#39; =&gt; &#39;Описание&#39;));        }        $formMapper -&gt;end();При создании новой сущности Sonata создает пустой объект этой сущности, а при редактировании, получает его из базы. Этот объект мы получаем посредством метода getSubject(), и, если у объект есть id, то значит, что он уже есть в базе, а, следовательно, мы редактируем объект.Также здесь присутствуют два неупомянутых методы with() и end(). Они позволяют группировать поля в fieldset.  Этот же трюк можно использовать, чтобы устанавливать значения полей по умолчанию:&lt;?php        if (!$this-&gt;getSubject()-&gt;getId()) {                $this-&gt;getSubject()-&gt;setSomeValue($someValue);        }  Для работы с другими сущностями вам может понадобиться получить  entityManager:&lt;?php        $em = $this-&gt;getModelManager()-&gt;getEntityManager($this-&gt;getSubject());Обратите внимание, что getEntityManager принимает в качестве параметра объект (например тот, который мы редактируем)  Соната довольно логично использует шаблонизатор, поэтому переопределить шаблон того или иного action’a (edit, list) довольно просто. Сначала вам необходимо создать шаблон и унаследовать его от сонатовского:\{\% extends &#39;SonataAdminBundle:CRUD:base_list.html.twig&#39; %}Затем, в шаблоне переопределите соответствующие блоки. Финальный шаг - указать админ классу, какой шаблон нужно использовать для action’a. Я это делал, вызывая метод setTemplate внутри метода configureFormFields, хотя можно было бы придумать и более изящный способ:    protected function configureFormFields(FormMapper $formMapper)    {        $this-&gt;setTemplate(&#39;edit&#39;, &#39;SonataTemplatesBundle:Default:edit_with_top_actions.html.twig&#39;);Ну вот, думаю на этом все =) надеюсь эта информация будет вам полезна, дерзайте.">
    <meta itemprop="datePublished" content="2012-09-02T11:35:47-05:00">
    

    <div class="page__inner-wrap">
        <header >
          <h1 id="page-title" class="page__title" itemprop="headline">Архитектура Sonata Admin Bundle
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 мин на чтение

</p>
          
        </header>

      <section class="page__content" itemprop="text">
        
        <p><a href="http://fateev.pro/wp-content/uploads/2012/09/sonata.jpg"><img class="size-full wp-image-78 alignleft" title="sonata" src="http://fateev.pro/wp-content/uploads/2012/09/sonata.jpg" alt="" width="59" height="59" /></a>Sonata Admin Bundle, как и вся концепция symfony2 поддерживает сервисно-ориентированную архитектуру, поэтому, чтобы сделать CRUD для сущности, в первую очередь, необходимо создать определенный сервис.</p>

<!--more-->
<p>Приведу пример сервиса в моем проекте:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">services</span><span class="pi">:</span><span class="err">
</span>
    <span class="s">mtools.budget.expense.admin</span><span class="err">:
</span>
        <span class="s">id</span><span class="pi">:</span> <span class="s">mtools.budget.expense.admin</span><span class="err">
</span>
        <span class="s">class</span><span class="pi">:</span> <span class="s">Mtools\BudgetBundle\Admin\BudgetExpenseAdmin</span><span class="err">
</span>
        <span class="s">tags</span><span class="err">:
</span>
            <span class="s">- { name</span><span class="pi">:</span> <span class="s">sonata.admin, manager_type</span><span class="pi">:</span> <span class="s">orm, group</span><span class="pi">:</span> <span class="s">budget, label</span><span class="pi">:</span> <span class="s">Расходная cмета }</span><span class="err">
</span>
        <span class="s">arguments</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">null</span><span class="pi">,</span> <span class="nv">Mtools\BudgetBundle\Entity\BudgetExpense</span><span class="pi">,</span> <span class="nv">MtoolsBudgetBundle</span><span class="pi">:</span><span class="nv">BudgetExpenseAdmin&amp;nbsp;</span><span class="pi">]</span></code></pre></figure>

<p>Итак, по порядку:</p>
<ul>
	<li>mtools.budget.expense.admin - выступает в качестве родительского id сервиса, на следующей строчке, я все же явно указываю, что это id сервиса</li>
	<li>class - это админ класс для вашей сущности, должен быть наследником&nbsp;Sonata\AdminBundle\Admin\Admin</li>
	<li>tags - теги, по которым соната определяет, что этот сервис принадлежит ей. Обращу внимание на то, что group действителен только в том случае, если в конфигурации сонаты вы явно не указывает список групп, которые должны выводиться в dashboard; label - фактически, это имя сущности, которое будет выводиться в dashboard</li>
	<li>arguments - первый аргумент... честно говоря хз что это, второй аргумент - это класс сущности, которую мы редактируем, третий аргумент - это класс контроллера, который будет обслуживать нашу сущность, должен быть &nbsp;наследником&nbsp;Sonata\AdminBundle\Controller\CRUDController</li>
</ul>
<p>Теперь рассмотрим архитектуру админ класса. Так как основная задача админгенератора, обеспечить CRUD, то, соответственно, все архитектура завязана вокруг этих действий. Основными являются три метода для настройки админ класса:</p>
<ul>
	<li>configureFormFields - в данном методе мы настраиваем вид формы для редактирования нашей сущности</li>
	<li>configureListFields - этот метод определяет набор колонок, которые будут отображены при выводе списка сущностей для редактирования</li>
	<li>configureDatagridFilters - а в этом методе мы определяем набор фильтров, которые мы сможем использовать для поиска по сущностям (<a title="SonataAdminBundle: фильтры" href="http://fateev.pro/symfony-sonata/sonataadminbundle-filtry.html">Более подробная информация о фильтрах</a>)</li>
	<li>configureRoutes - соната динамически генерирует роуты для сущностей, с помощью этого метода можно управлять как уже сгенерированными роутами для CRUD'a (create, edit, delete), так и добавить свои роуты, например для <a title="SonataAdminBundle: как добавить произвольную страницу к сущности" href="http://fateev.pro/symfony-sonata/sonataadminbundle-kak-dobavit-proizvolnuyu-stranicu-k-sushhnosti.html">произвольной страницы</a></li>
</ul>
<p>Вцелом, принцип настройки админ класса сходен для всех трех методов, но есть и свои особенности. В простейшем виде метод может выглядеть следующим обарзом:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureFormFields</span><span class="p">(</span><span class="nx">FormMapper</span> <span class="nv">$formMapper</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="nv">$formMapper</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Название'</span><span class="p">))</span>
        <span class="p">;</span>
        <span class="o">...</span></code></pre></figure>

<p>Мы используем метод add класса FormMapper, чтобы добавить в форму поле для редактирования названия сущности. Первый аргумент  - идентификатор поля сущности, второй (чаще всего будет null) - тип поля формы, соната, чаще всего, без проблем определяет тип поля автоматически и подбирает соответствующий тип поля формы, третий - список опции для поля.</p>
<blockquote>Замечу то, что соната позволяет использовать стандартные типы полей формы symfony2, а это дает возможность очень гибко строить кастомные формы. В дальнеших статьях я расскажу о том как сделать свой тип поля, а также расскажу о готовых решениях.</blockquote>
<p>Для связных сущностей, возможно, придется явно указывать тип поля sonata_type_model, у которого есть довольно удобная опция edit =&gt; ‘list’, позволяющая производить создание и поиск нужной сущности прямо в попапе. Хотя, конечно, на тот момент, когда я использовал эту фишку, она была довольно сырой и было несколько неприятных багов, вроде того, что нужно инициализировать кастомные js скрипты специально для попапа, поэтому я стал использовать немного другое решение, но об этом в другой статье.</p>

<p>Пример поля sonata_type_model с опцией edit =&gt; ‘list’:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureFormFields</span><span class="p">(</span><span class="nx">FormMapper</span> <span class="nv">$formMapper</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$formMapper</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Название'</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'subProject'</span><span class="p">,</span> <span class="s1">'sonata_type_model'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Подпроект'</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">'edit'</span> <span class="o">=&gt;</span> <span class="s1">'list'</span><span class="p">))</span></code></pre></figure>

<p>Выглядит это примерно так:</p>

<p><a href="http://fateev.pro/wp-content/uploads/2012/09/Screen-Shot-2012-09-14-at-12.36.01-AM.png"><img class="size-medium wp-image-96 alignleft" title="Screen Shot 2012-09-14 at 12.36.01 AM" src="http://fateev.pro/wp-content/uploads/2012/09/Screen-Shot-2012-09-14-at-12.36.01-AM-300x65.png" alt="" width="300" height="65" /></a></p>

<p><a href="http://fateev.pro/wp-content/uploads/2012/09/Screen-Shot-2012-09-14-at-12.37.47-AM.png"><img class="alignnone size-medium wp-image-97" title="Screen Shot 2012-09-14 at 12.37.47 AM" src="http://fateev.pro/wp-content/uploads/2012/09/Screen-Shot-2012-09-14-at-12.37.47-AM-300x126.png" alt="" width="300" height="126" /></a></p>
<blockquote>Полный список типов полей, доступных в сонате, можно посмотреть в файле сервисов Sonata/AdminBundle/Resources/config/form_types.xml</blockquote>
<p>Метод configureListFields, очень похож на configureFormFields, но в нем есть дополнительный метод addIdentifier, который добавляет не только колонку со значением поля, но и делает эту колонку ссылкой для редактирования сущности, если вы опустите это поле, то просто не сможете отредактировать вашу сущность. Вот пример метода:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureListFields</span><span class="p">(</span><span class="nx">ListMapper</span> <span class="nv">$listMapper</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="nv">$listMapper</span>
            <span class="o">-&gt;</span><span class="na">addIdentifier</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Название'</span><span class="p">))</span>
        <span class="o">...</span></code></pre></figure>

<blockquote>Обратите внимание, что в configureFormFields НЕ НУЖНО использовать sonata_type_model, Sonata сама должна определить тип поля и вывести соответствующее значение. Кстати значение связных сущностей выводится из метода __toString(), поэтому если вы выводите связные сущности в списке, этот метод обязателен для реализации</blockquote>
<p> Метод configureDatagridFields немного более сложный, хотя схож с предыдущими. Пример:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureDatagridFilters</span><span class="p">(</span><span class="nx">DatagridMapper</span> <span class="nv">$datagridMapper</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$datagridMapper</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Название'</span><span class="p">))</span>
        <span class="p">;</span>
    <span class="p">}</span></code></pre></figure>

<p>Не смотря на то, что вид метода add такой же, как и прошлых, он в корне отличается от них. Второй параметр - это не тип поля, а тип фильтра, фактически он определяет то, как поле будет фильтроваться в базе. Сам тип поля формы в фильтре, а также его опции - это, соответственно, четвертый и пятый параметры, принцип у них такой же, как и в двух предыдущих методых.</p>
<blockquote>Тип фильтра, по умолчанию, ставьте null, Sonata чаще всего сама легко определяет нужный, но, если что, список доступных типов фильтра можно посмотреть в файле Sonata/DoctrineOMRAdminBundle/Resources/config/doctrine_orm_filter_types.xml</blockquote>
<p>Что касается метода configureRoutes, то его можно использовать, к примеру, чтобы запретить какое либо из действий для сущности:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureRoutes</span><span class="p">(</span><span class="nx">RouteCollection</span> <span class="nv">$collection</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">'create'</span><span class="p">);</span>
    <span class="p">}</span></code></pre></figure>

<p>Данный код запрещает создание новых сущностей. Соната сама скроет все ссылки на создание новой сущности. Более подробно про configureRoutes рассказано <a title="SonataAdminBundle: как добавить произвольную страницу к сущности" href="http://fateev.pro/symfony-sonata/sonataadminbundle-kak-dobavit-proizvolnuyu-stranicu-k-sushhnosti.html">здесь</a>.</p>

<p>В админ классе есть методы-события, связанные с CRUD’ами: prePersist, postPersist, preUpdate, postUpdate, preRemove, postRemove. Эти методы, в качестве единственного аргумента, получают редактируемый/создаваемый нами объект/ В большинстве случаев, этих методов вполне достаточно, чтобы обслужить создание/обновление/удаление объекта.</p>

<p>После того как вы закончите с админ классом и опишите новый сервис, если у вас конфигурация админ бандла по умолчанию, то в dashboard появится новый пункт для редактирования вашей сущности. Это происходит автоматически, соната определяет нужные сервисы по тегу sonata.admin.</p>

<p>Если нужно выводить конкретную структуру админ сервисов в dashboard, то для этого предусмотрена определенная конфигурация админ бандла:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">sonata_admin</span><span class="pi">:</span><span class="err">
</span>
    <span class="na">dashboard</span><span class="pi">:</span><span class="err">
</span>
        <span class="na">groups</span><span class="pi">:</span><span class="err">
</span>
            <span class="na">sonata_user</span><span class="pi">:</span><span class="err">
</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s">Пользователи</span><span class="err">
</span>
                <span class="na">items</span><span class="pi">:</span><span class="err">
</span>
                   <span class="pi">-</span> <span class="s">sonata.user.admin.user</span></code></pre></figure>

<p>sonata.user.admin.user - здесь, соответственно, id сервиса, который попадет в группу, sonata_user произвольный, уникальный идентификатор группы, label - имя группы, которое будет отображаться в dashboard’e</p>

<p>Приведу несколько трюков, которые могут пригодиться:</p>

<ol>
  <li>Вывести разный набор полей, в зависимости от того, редактируем мы сущность или создаем</li>
</ol>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureFormFields</span><span class="p">(</span><span class="nx">FormMapper</span> <span class="nv">$formMapper</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$formMapper</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'Подпроект'</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Название'</span><span class="p">,</span>
                <span class="p">))</span>
        <span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">//если мы редактируем объект
</span>
            <span class="nv">$formMapper</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'description'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Описание'</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nv">$formMapper</span> <span class="o">-&gt;</span><span class="na">end</span><span class="p">();</span></code></pre></figure>

<p>При создании новой сущности Sonata создает пустой объект этой сущности, а при редактировании, получает его из базы. Этот объект мы получаем посредством метода getSubject(), и, если у объект есть id, то значит, что он уже есть в базе, а, следовательно, мы редактируем объект.</p>

<p>Также здесь присутствуют два неупомянутых методы with() и end(). Они позволяют группировать поля в fieldset.</p>

<ol>
  <li>Этот же трюк можно использовать, чтобы устанавливать значения полей по умолчанию:</li>
</ol>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setSomeValue</span><span class="p">(</span><span class="nv">$someValue</span><span class="p">);</span>
        <span class="p">}</span></code></pre></figure>

<ol>
  <li>Для работы с другими сущностями вам может понадобиться получить  entityManager:</li>
</ol>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
        <span class="nv">$em</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModelManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">());</span></code></pre></figure>

<blockquote>Обратите внимание, что getEntityManager принимает в качестве параметра объект (например тот, который мы редактируем)</blockquote>
<ol>
  <li>Соната довольно логично использует шаблонизатор, поэтому переопределить шаблон того или иного action’a (edit, list) довольно просто. Сначала вам необходимо создать шаблон и унаследовать его от сонатовского:</li>
</ol>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="o">%</span> <span class="k">extends</span> <span class="s1">'SonataAdminBundle:CRUD:base_list.html.twig'</span> <span class="o">%</span><span class="p">}</span></code></pre></figure>

<p>Затем, в шаблоне переопределите соответствующие блоки. Финальный шаг - указать админ классу, какой шаблон нужно использовать для action’a. Я это делал, вызывая метод setTemplate внутри метода configureFormFields, хотя можно было бы придумать и более изящный способ:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">    <span class="k">protected</span> <span class="k">function</span> <span class="nf">configureFormFields</span><span class="p">(</span><span class="nx">FormMapper</span> <span class="nv">$formMapper</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">'edit'</span><span class="p">,</span> <span class="s1">'SonataTemplatesBundle:Default:edit_with_top_actions.html.twig'</span><span class="p">);</span></code></pre></figure>

<p>Ну вот, думаю на этом все =) надеюсь эта информация будет вам полезна, дерзайте.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Метки: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/php" class="page__taxonomy-item" rel="tag">php</a><span class="sep">, </span>
    
      
      
      <a href="/tags/symfony-sonata" class="page__taxonomy-item" rel="tag">symfony-sonata</a><span class="sep">, </span>
    
      
      
      <a href="/tags/symfony2" class="page__taxonomy-item" rel="tag">symfony2</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Разделы: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/symfony-sonata" class="page__taxonomy-item" rel="tag">Symfony Sonata</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Дата изменения:</strong> <time datetime="2012-09-02T11:35:47-05:00">September 2, 2012</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Поделиться</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0+Sonata+Admin+Bundle%20https%3A%2F%2Ffateev.pro%2Fsymfony-sonata%2Farxitektura-sonata-admin-bundle.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ffateev.pro%2Fsymfony-sonata%2Farxitektura-sonata-admin-bundle.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Ffateev.pro%2Fsymfony-sonata%2Farxitektura-sonata-admin-bundle.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Поделиться LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/chronicles/o-tom-kak-ya-prishel-k-symfony2.html" class="pagination--pager" title="О том, как я пришел к Symfony2
">Предыдущая</a>
    
    
      <a href="/symfony-sonata/genemu-form-bundle.html" class="pagination--pager" title="Genemu Form Bundle
">Следующая</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">Вам также может понравиться</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/bug-prioritization-matrix.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/startup-challenges/ensuring-the-quality-appium.html" rel="permalink">Startup challenges: Lost bugs, anxiety and burnout
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Bugs in your company get lost in the chat, users leave, management blames engineers, engineers feel guilty and anxious, get burned out? We’ve been there. Her...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/testing-pyramid.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/startup-challenges/ensuring-the-quality-appium.html" rel="permalink">Startup challenges: Ensuring the quality with Appium
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">One of the main challenges in our startup is to ensure that our product is of good quality. We decided to try Appium to test end-to-end scenarios.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/abstract-code.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/en/programming/how-to-clean-a-legacy-code-stop-complaining-start-doing.html" rel="permalink">How to clean a legacy code: stop complaining, start doing
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Most of the articles and books tell you how to write a “good code”. But in real life, you often find yourself deep in the shit after joining some company or ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/growing_junior.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ru/programming/are-you-growing-your-juniors-right.html" rel="permalink">Правильно ли вы растите своих джунов?
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 мин на чтение

</p>
    
    <p class="archive__item-excerpt" itemprop="description">У меня есть ученик. В начале его пути я помогал ему постичь наше ремесло, потом он попал в одну крупную компанию. Что с ним там сделали, вы не поверите…
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Связаться со мной:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> RSS-лента</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Ivan Fateev. Сайт работает на <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  
    <script src="/assets/js/main.min.js"></script>
  
    <script src="/assets/js/footerPixels.js"></script>
  
    <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  










  </body>
</html>
